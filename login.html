<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Login - FarPay</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body{font-family:Inter,system-ui;margin:0;background:linear-gradient(180deg,#071024,#07112b);color:#eaf2ff;display:flex;align-items:center;justify-content:center;height:100vh}
    .box{width:420px;background:rgba(255,255,255,0.03);padding:28px;border-radius:14px;box-shadow:0 10px 40px rgba(2,6,23,0.6)}
    h2{margin:0 0 8px 0}
    label{display:block;font-size:13px;margin-top:12px;opacity:0.9}
    input{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
    .btn{margin-top:16px;background:#7c3aed;padding:10px 12px;border-radius:10px;border:0;color:white;width:100%;font-weight:600;cursor:pointer}
    .link{margin-top:10px;text-align:center;opacity:0.85}
  </style>
</head>
<body>
  <div class="box">
    <h2>Login</h2>
    <div style="font-size:13px;opacity:0.8">Use email or username</div>

    <label>Email or username</label>
    <input id="credential" placeholder="email or username">

    <label>Password</label>
    <input id="password" type="password" placeholder="password">

    <button class="btn" onclick="login()">Login</button>

    <div class="link"><a href="reset_request.html" style="color:#c7b3ff">Forgot password?</a></div>
    <div class="link">New? <a href="signup.html" style="color:#c7b3ff">Create account</a></div>
  </div>

  <script>
    async function login(){
      const credential = document.getElementById('credential').value.trim();
      const password = document.getElementById('password').value;
      if(!credential || !password){ alert('Complete fields'); return; }
      const res = await fetch('/api/login', {
        method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ credential, password })
      });
      const data = await res.json();
      if(data.require2fa){
        // ask for 2FA code
        const code = prompt('Enter your 2FA code from authenticator app:');
        if(!code) return alert('2FA code required.');
        const r = await fetch('/api/verify-2fa', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ tmpToken: data.tmpToken, code })});
        const d = await r.json();
        if(d.ok){ alert('Logged in'); window.location='dashboard.html'; } else alert(d.error || '2FA failed');
      } else if(data.ok){ alert('Logged in'); window.location='dashboard.html'; }
      else alert(data.error || 'Login failed');
    }
  </script>
</body>
</html>
